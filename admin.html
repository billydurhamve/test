<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h1>Admin Dashboard</h1>

  <h2>Add New User</h2>
  <form id="addUserForm">
    <input type="text" id="newUsername" placeholder="Username" required>
    <input type="password" id="newPassword" placeholder="Password" required>
    <select id="newRole" required>
      <option value="">Select Role</option>
      <option value="employee">Employee</option>
      <option value="admin">Admin</option>
    </select>
    <button type="submit">Add User</button>
  </form>

  <h2>All Users</h2>
  <div id="userList" class="user-list"></div>

  <button onclick="logout()" class="logout-btn">Logout</button>
</div>

<script>
async function fetchUsers(){
  const res = await fetch('/users');
  const users = await res.json();
  const userList = document.getElementById('userList');
  userList.innerHTML = '';
  users.forEach(u => {
    const div = document.createElement('div');
    div.classList.add('user-card');
    div.innerHTML = `<strong>${u.username}</strong> (${u.role})<br>Forms: ${u.forms ? u.forms.map(f=>f.name).join(', ') : 'None'}`;
    userList.appendChild(div);
  });
}

document.getElementById('addUserForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const username = document.getElementById('newUsername').value;
  const password = document.getElementById('newPassword').value;
  const role = document.getElementById('newRole').value;

  const res = await fetch('/addUser', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({username, password, role})
  });

  if(res.ok){
    alert('User added');
    fetchUsers();
  } else {
    alert(await res.text());
  }
});

fetchUsers();

function logout(){
  sessionStorage.clear();
  window.location.href = 'index.html';
}
</script>

</body>
</html>
